---
title: æ ‘çŠ¶æ•°ç»„
date: 2024-04-27 23:09:57
updated: '2024-04-28T20:37:38.281+08:00'
tags:
---

æ ‘çŠ¶æ•°ç»„è®²è§£

<!-- more -->


## ç®€ä»‹

### å®šä¹‰

æ ‘çŠ¶æ•°ç»„æ˜¯ä¸€ç§ä»£ç é‡å°‘ã€å¸¸æ•°å°çš„ä¼˜ç§€æ•°æ®ç»“æ„ï¼Œå¯ä»¥åœ¨ $O(\log n)$ çš„æ—¶é—´å†…è¿›è¡Œæ•°ç»„ **æ»¡è¶³ç»“åˆå¾‹è¿ç®—** çš„å•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢ï¼Œé€šè¿‡ä¸€å®šçš„æ”¹å˜ä¹Ÿå¯ä»¥è¿›è¡ŒåŒºé—´ä¿®æ”¹å•ç‚¹æŸ¥è¯¢ç­‰å¤æ‚æ“ä½œã€‚

æ ‘çŠ¶æ•°ç»„åœ¨ä½¿ç”¨æ—¶å˜å½¢è¾ƒå°‘ï¼Œä¸»è¦çš„å˜å½¢æœ‰ æ ‘çŠ¶æ•°ç»„ä¸ŠäºŒåˆ†ã€‚

## åŸºç¡€æ ‘çŠ¶æ•°ç»„

ä»¥æ ‘çŠ¶æ•°ç»„å¤„ç†åŒºé—´å’Œä¸ºä¾‹è®²è§£

æˆ‘ä»¬çŸ¥é“ï¼ŒåŒºé—´å’Œå¯ä»¥é€šè¿‡ä¸¤ä¸ªå‰ç¼€å’Œç›¸å‡è·å¾—ï¼Œå› æ­¤ä»¥ä¸‹åªè®¨è®ºå‰ç¼€å’Œã€‚

$$
\sum_{i = l}^{r} a_{i} = \sum_{i = 1}^{r} a_{i} - \sum_{i - 1}^{l - 1}a_{i}
$$

### å¼•å…¥


è€ƒè™‘è¿™æ ·çš„ä¸€ä¸ªé—®é¢˜ï¼š

{%note success%}
ç»™å®šä¸€ä¸ªæ•°ç»„ $a$ï¼Œæœ‰ $Q$ æ¬¡ä»¥ä¸‹ä¸¤ç§æ“ä½œï¼š
  
1. ç»™å®š $k$ï¼Œè¾“å‡º $a_{1} \sim a_{k}$ çš„å’Œã€‚
2. ç»™å®š $k$ å’Œ $x$ï¼Œå°† $a_{k}$ å˜ä¸º $a_{k} + x$
{%endnote%}

é’ˆå¯¹ä¸Šé¢çš„è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§åŸºç¡€æš´åŠ›åšæ³•ï¼Œå¤æ‚åº¦å‡ä¸º $O(Qn)$ï¼Œä¼šè¶…å‡ºæ—¶é—´é™åˆ¶ã€‚

{% tabs å¼•å…¥é¢˜ç›®è§£æ³• %}
<!-- tab è§£æ³• 1 -->
æˆ‘ä»¬åªç»´æŠ¤åŸæ•°ç»„ï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶ä» $1$ åˆ° $k$ åŠ ä¸€éè·å¾—ç­”æ¡ˆã€‚

è¿™ç§è§£æ³•æ›´æ”¹çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ï¼Œåœ¨æŸ¥è¯¢æ“ä½œè¾ƒå°‘æ—¶æœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚
<!-- endtab -->
<!-- tab è§£æ³• 2 -->
æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªå‰ç¼€å’Œæ•°ç»„ $b$ï¼Œæ¯æ¬¡æ›´æ–°æ—¶éœ€è¦æ›´æ–° $b_{k \sim n}$ çš„æ‰€æœ‰å‰ç¼€å’Œï¼ŒæŸ¥è¯¢æ—¶åªéœ€è¦è¾“å‡º $b_{k}$ã€‚
è¿™ç§è§£æ³•æ›´æ”¹çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ï¼Œåœ¨ä¿®æ”¹æ“ä½œè¾ƒå°‘æ—¶æœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚

åœ¨åŒä¸€ä¸ªç¨‹åºå†™å‡ºä¸¤ç§è§£æ³•ï¼Œå®é™…è°ƒç”¨æ—¶æ ¹æ®æ•°æ®ç‰¹å¾é€‰æ‹©è§£æ³•çš„å¤„ç†æ–¹å¼ç§°ä¸º **æ•°æ®åˆ†æ²»**ï¼Œè¿™å¹¶éæˆ‘ä»¬ä»Šå¤©è®¨è®ºçš„é‡ç‚¹ï¼Œè¯¦æƒ…å¯ä»¥æœŸå¾…ä»¥åçš„æ–‡ç« ã€‚
<!-- endtab -->
{% endtabs %}


### æŸ¥è¯¢

è€ƒè™‘ä¸€ä¸‹åˆšåˆšä¸¤ç§ç®—æ³•çš„ç¼ºç‚¹ï¼šéœ€è¦æ›´æ–°æˆ–æŸ¥è¯¢çš„å…ƒç´ è¿‡å¤šã€‚

æœ‰æ²¡æœ‰ä¸€ç§æ–¹æ³•èƒ½å°†å‰ç¼€å’Œåˆ†ä¸ºè‹¥å¹²ä¸ªå°åŒºé—´çš„å’Œï¼ˆåŒæ—¶åŒºé—´æ•°ä¸èƒ½å¤ªå¤šï¼Œå¦åˆ™æ›´æ–°æ—¶å¤æ‚åº¦é«˜ï¼‰ï¼Œå¹¶ä¸”æ˜“äºç»´æŠ¤å‘¢ï¼Ÿ

{%note æ‹“å±•%}
å®é™…ä¸Šï¼Œæœ‰ä¸€ç§ä¼˜åŒ–ç®—æ³•ï¼š**åˆ†å—**ï¼Œä¸“é—¨ç”¨æ¥è§£å†³åˆšåˆšæ‰€æåˆ°çš„ç¼ºç‚¹ã€‚
è¯¥ç®—æ³•å°†æ•°ç»„åˆ†ä¸º $\sqrt{n}$ å—ï¼Œæ¯å—æœ€å¤š $\sqrt{n}$ ä¸ªå…ƒç´ ï¼Œä½¿å¾—å•æ¬¡æ›´æ–°ã€æŸ¥è¯¢çš„å¤æ‚åº¦å‡ä¸º $O(\sqrt{n})$ã€‚
åˆ†å—ç®—æ³•èƒ½è§£å†³çš„é—®é¢˜æ›´å¤šï¼Œä½†æ—¶é—´å¤æ‚åº¦é«˜äºæ ‘çŠ¶æ•°ç»„ã€‚
æ­¤å¤„ä¸è¿‡å¤šä»‹ç»è¯¥ç®—æ³•ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒåˆ†å—ä¸“é¢˜çš„æ–‡ç« ã€‚
{%endnote%}

åœ¨è®¡ç®—å’Œæ›´æ–°å‰ç¼€å’Œæ—¶ï¼Œå¦‚æœèƒ½ä¿è¯å•æ¬¡æŸ¥è¯¢/ä¿®æ”¹çš„å…ƒç´ æ•°é‡**å‡ä¸è¶…è¿‡ $\log n$ ä¸ª**ï¼Œåˆ™èƒ½å¾—åˆ°å¤æ‚åº¦ä¸º $O(n \log n)$ çš„ç®—æ³•ã€‚

è€ƒè™‘åˆ°ä¸€ä¸ªæ•°å­—è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶çš„ä½æ•°ä¸è¶…è¿‡ $\log k$ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§äºŒè¿›åˆ¶ä½æ‹†åˆ†æ•°å­—ï¼š

ä¾‹å¦‚å¯¹äºæ•°å­— $166$ï¼Œè½¬åŒ–ä¸ºäºŒè¿›åˆ¶æ—¶ä¸º $(10100110)\_{2}$ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†ä¸º $(10)\_{2}+(100)\_{2}+(100000)\_{2}+(10000000)\_{2}$ï¼Œä¹Ÿå°±æ˜¯é•¿åº¦åˆ†åˆ«ä¸º $2$ã€$4$ã€$32$ã€$128$ çš„å­åŒºé—´ã€‚

å¯ä»¥çœ‹å‡ºï¼Œæ‹†åˆ†æ•°å­—æ—¶ï¼Œæ¯æ¬¡å–æ•°å­—æœ€ä½ä½çš„ $1$ åŠå…¶åé¢çš„ $0$ ç»„æˆçš„äºŒè¿›åˆ¶æ•°ä½œä¸ºé•¿åº¦ã€‚æˆ‘ä»¬å°†â€œå–æ•°å­—æœ€ä½ä½çš„ $1$ åŠå…¶åé¢çš„ $0$â€è¿™ä¸ªæ“ä½œå®šä¹‰ä¸ºå‡½æ•° `lowbit`ï¼Œä¾‹å¦‚ $\mathrm{lowbit}(72)=\mathrm{lowbit}((1001000)\_{2})=(1000)_{2}=8$ ã€‚

è¿™ä¸ªå‡½æ•°ç”¨ä»£ç å®ç°çš„æ–¹å¼å¦‚ä¸‹ï¼š

```cpp
int lowbit(int x)
{
    return (-x)&x;
}
```

å…¶ä¸­æ¶‰åŠè®¡ç®—æœºå­˜å‚¨è´Ÿæ•°çš„æ–¹å¼â€”â€”è¡¥ç ï¼Œåœ¨æ­¤ä¸å¯¹åŸç†è¿›è¡Œè§£é‡Šï¼Œç›´æ¥èƒŒè¯µå³å¯ã€‚

---

æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ•°ç»„ $tree$ æ¥è®°å½•é¢„å¤„ç†å‡ºæ¯ä¸ªå­åŒºé—´çš„å€¼ã€‚

åœ¨æ ‘çŠ¶æ•°ç»„ä¸­ï¼Œè§„å®š $tree[i]$ ä»£è¡¨**ä»¥ $i$ ä¸ºåŒºé—´ç»ˆç‚¹ï¼Œé•¿åº¦ä¸º $\mathrm{lowbit}(i)$ çš„å­åŒºé—´**ï¼ˆå³å­åŒºé—´ $[i-\mathrm{lowbit}(i)+1,i]$ï¼‰ã€‚

å›é¡¾æˆ‘ä»¬ä¹‹å‰å¯¹æ•°å­— $166$ çš„æ‹†åˆ†æ–¹å¼ï¼Œå‘ç°æ°å¥½æ¯æ¬¡æ‹†åˆ†çš„é•¿åº¦å‡ä¸º $\mathrm{lowbit}(x)$ï¼Œäºæ˜¯æˆ‘ä»¬åªéœ€è¦è®©æ‹†åˆ†å‡ºæ¯ä¸ªå­åŒºé—´çš„ç»ˆç‚¹æ°å¥½ä¸º $x$ å³å¯ç¬¦åˆ $tree[x]$ çš„å®šä¹‰ï¼Œè¿™æ˜¯å¾ˆå®¹æ˜“åšåˆ°çš„ï¼šä»¥åˆå§‹æ•°å­—ä¸ºå³ç«¯ç‚¹ï¼Œåªéœ€è¦æ¯æ¬¡å–èµ° $\mathrm{lowbit}(x)$ çš„åŒºé—´ï¼Œå‰©ä¸‹çš„æ•°å­—å˜ä¸º $x-\mathrm{lowbit}(x)$ï¼Œä¸æ–­é‡å¤è¿™ä¸ªè¿‡ç¨‹ç›´åˆ° $x=0$ å³å¯ã€‚

æŸ¥è¯¢éƒ¨åˆ†ä»£ç ï¼š

```cpp
int query(int x)
{
    int sum = 0;
    // æœ€å¤šå‡ log(x) æ¬¡ï¼Œå¤æ‚åº¦ä¸º log(x)
    for(;x;x -= lowbit(x))
    {
        sum += tree[x];
    }
    return sum;
}
```

### ä¿®æ”¹

æŸ¥è¯¢çš„éƒ¨åˆ†å·²ç»è§£å†³äº†ï¼Œé‚£ä¹ˆä¿®æ”¹æ“ä½œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

æƒ³æƒ³æ•°ç»„ $tree$ çš„å®šä¹‰ï¼Œå‘ç°ä¿®æ”¹**åŸæ•°ç»„**ä½ç½® $i$ï¼Œå½±å“çš„æ˜¯ $tree$ æ•°ç»„ä¸­é‚£äº› $k-\mathrm{lowbit}(k)+1 \leq i \leq k$ çš„ä½ç½®ï¼Œè¿™æ ·çš„ä½ç½®æœ‰å¤šå°‘ä¸ªå‘¢ï¼Ÿ

æˆ‘ä»¬åˆ†æä¸€ä¸‹äºŒè¿›åˆ¶æ•°å­—çš„ç‰¹å¾ï¼ˆä»¥ä¸‹æ•°å­—å‡ä¸ºäºŒè¿›åˆ¶ï¼‰ï¼š

{%note info%}

éšä¾¿å–ä¸€ä¸ªæ•°å­— $i$ï¼Œæšä¸¾å‡ ä¸ª $k$ çœ‹çœ‹æ»¡è¶³è¦æ±‚çš„æ•°å­—æœ‰ä»€ä¹ˆç‰¹å¾ã€‚

é¦–å…ˆ $k-\mathrm{lowbit}(k)+1 \leq i$ ç­‰ä»·äº $k-\mathrm{lowbit}(k) \leq i - 1$ï¼Œä¸” $k$ è¦å¤§äºç­‰äº $i$ã€‚

```txt
i:   101000
i-1: 100111                 100111
k:   110100 --> k-lowbit(k) 110000 > i-1 
k:   101001 --> k-lowbit(k) 101000 > i-1 // å¦‚æœå‰é¢ç›¸åŒï¼Œä½†åé¢æœ‰ 1ï¼Œä¼šæ›´å¤§
k:   101000 --> k-lowbit(k) 100000 < i-1 
k:   110000 --> k-lowbit(k) 100000 < i-1
k:   111000 --> k-lowbit(k) 110000 > i-1 
```

**æ€§è´¨1ï¼š$k$ çš„åé¢ $0$ çš„ä¸ªæ•°åªèƒ½å¤§äºç­‰äº $i$ åé¢ $0$ çš„ä¸ªæ•°ã€‚å³ $\mathrm{lowbit}(k) \geq \mathrm{lowbit}(i)$**
**æ€§è´¨2: $k$ å‰é¢ï¼ˆé™¤å» $0$ çš„éƒ¨åˆ†ï¼‰ä¸èƒ½å°äº $i$ çš„ç›¸åŒåŒºåŸŸï¼Œå¦‚æœ $i$ è¿™éƒ¨åˆ†çš„æœ€åä¸€ä½æ˜¯ $0$ï¼Œåˆ™ $k$ è¿™éƒ¨åˆ†æœ€åä¸€ä½ä¸º $1$ï¼ˆå¦åˆ™è¿™ä¸ªä½ç½®å°±ä¸æ˜¯â€œå‰é¢â€äº†ï¼‰ï¼Œä¸”åªèƒ½å°†è¿™éƒ¨åˆ†çš„æœ€åä¸€ä½ä» $0$ å˜ä¸º $1$ï¼Œå…¶ä»–ä½ç½®ä¸èƒ½æ”¹å˜ã€‚ï¼ˆæœ€åä¸€ä¸ªä¾‹å­è¯´æ˜å¦‚æœå‰é¢æ”¹äº†ï¼Œä¼š $>i-1$ï¼‰**ã€‚

{%endnote%}

å¯ä»¥å‘ç°ï¼Œè¿™æ ·çš„æ•°å­—ä¸€å®šä¸è¶…è¿‡ $\log(k)$ ä¸ªï¼Œä¿®æ”¹çš„æ—¶é—´å¤æ‚åº¦å¾—ä»¥ä¿è¯ã€‚

å¦‚ä½•è·å¾—æ‰€æœ‰æ»¡è¶³è¦æ±‚çš„ $k$ å‘¢ï¼Ÿå‘ç°åªéœ€è¦ä» $i$ å¼€å§‹ï¼Œä¸æ–­å°† $i$ åŠ ä¸Š $\mathrm{lowbit}(i)$ å³å¯ã€‚

äºæ˜¯ä¿®æ”¹éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š

```cpp
void update(int x,int val)
{
    for(;x<=n;x+=lowbit(x))
    {
        tree[x] += val;
    }
}
```

### è®²è§£æ€»ç»“

è¿™éƒ¨åˆ†å†…å®¹çš„åŸç†å¯èƒ½å¹¶ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œä¸è¿‡ç”±äºä»£ç ç®€å•ï¼Œå¯ä»¥å…ˆåªè®°å¿†ä»£ç éƒ¨åˆ†ï¼Œéšç€å­¦ä¹ çš„æ·±å…¥ç†è§£çš„ä¼šè¶Šæ¥è¶Šå¥½ã€‚

### æ ‘çŠ¶æ•°ç»„çš„åŒºé—´ä¿®æ”¹ å•ç‚¹æŸ¥è¯¢

æ ‘çŠ¶æ•°ç»„å¯ä»¥ç»“åˆå·®åˆ†ç®—æ³•å®ç°åŒºé—´ä¿®æ”¹ï¼Œå…·ä½“çš„ï¼Œæˆ‘ä»¬ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤åŸæ•°ç»„çš„å·®åˆ†æ•°ç»„ $b$ï¼š

$$
b_{i} = \begin{cases}
a_{i} & i=1 \\\\
a_{i} - a_{i - 1} & \mathrm{other}
\end{cases}
$$

æ ¹æ®å·®åˆ†å’Œå‰ç¼€å’Œçš„ç›¸å…³çŸ¥è¯†ï¼Œå°†åŒºé—´ä¿®æ”¹ã€å•ç‚¹æŸ¥è¯¢è½¬åŒ–ä¸ºäº†å•ç‚¹ä¿®æ”¹ã€å‰ç¼€æŸ¥è¯¢é—®é¢˜ã€‚

tips: å¦‚æœä½ æ— æ³•ç†è§£è¿™é‡Œï¼Œä½ éœ€è¦æŸ¥çœ‹ å·®åˆ†å’Œå‰ç¼€å’Œ çš„ç›¸å…³çŸ¥è¯†ğŸ·

### ä¾‹é¢˜


{%note primary [SY50 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„](https://oj.cnryh.cn/problem#/SY50) %}

{% lg /images/logo.png %}
SY50 ã€æ¨¡æ¿ã€‘æ ‘çŠ¶æ•°ç»„ | https://oj.cnryh.cn/problem#/SY50 | 11 Online Judge
{% endlg %}


å¾ˆæ¨¡æ¿çš„é¢˜ç›®ï¼Œéœ€è¦æ³¨æ„å¸¸æ•°ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

{%note success Code%}

```cpp
#include <bits/stdc++.h>
using namespace std;
#define int long long
#define max_n 1001000
void read(int &p)
{
    p = 0;
    int k = 1;
    char c = getchar();
    while (c < '0' || c > '9')
    {
        if (c == '-')
        {
            k = -1;
        }
        c = getchar();
    }
    while (c >= '0' && c <= '9')
    {
        p = p * 10 + c - '0';
        c = getchar();
    }
    p *= k;
    return;
}
void write_(int x)
{
    if (x < 0)
    {
        putchar('-');
        x = -x;
    }
    if (x > 9)
    {
        write_(x / 10);
    }
    putchar(x % 10 + '0');
}
void writesp(int x)
{
    write_(x);
    putchar(' ');
}
void writeln(int x)
{
    write_(x);
    putchar('\n');
}
int nums[max_n], tree[max_n];
int n, Q;
int lowbit(int x)
{
    return (-x) & x;
}
void update(int x, int val)
{
    for (; x <= n; x += lowbit(x))
    {
        tree[x] += val;
    }
}
int query(int x)
{
    int res = 0;
    for (; x > 0; x -= lowbit(x))
    {
        res += tree[x];
    }
    return res;
}
signed main()
{
    read(n), read(Q);
    for (int i = 1; i <= n; i++)
    {
        update(i, i);
    }
    for (int i = 1, op, a, b; i <= Q; i++)
    {
        read(op), read(a), read(b);
        if (op == 1)
        {
            writeln(query(b) - query(a - 1));
        }
        else
        {
            update(a, b);
        }
    }
    return 0;
}
```
{%endnote%}

{%endnote%}



{%note primary [SY51 å° O æŸ¥æ•°å­—](https://oj.cnryh.cn/problem#/SY51) %}

{% lg /images/logo.png %}
SY51 å° O æŸ¥æ•°å­— | https://oj.cnryh.cn/problem#/SY51 | 11 Online Judge
{% endlg %}

{%note success å…ˆåšé¢˜ç›®å†çœ‹é¢˜è§£%}
{% tabs SY51é¢˜è§£ %}
<!-- tab é¢˜è§£ -->
#### SY51é¢˜è§£
åè½¬æ“ä½œå¹¶ä¸ç¬¦åˆæˆ‘ä»¬å¸¸è§çš„æ“ä½œç±»å‹ï¼Œå¯ä»¥å°è¯•è¿›è¡Œè½¬åŒ–ï¼Œå¯ä»¥å‘ç°é¢˜ç›®çš„åè½¬ç›¸å½“äº $a_{i} = (a_{i} + 1) \bmod 2$ï¼Œå› æ­¤å¯ä»¥**å°†åŒºé—´åè½¬æ“ä½œè½¬åŒ–ä¸ºåŒºé—´åŠ æ“ä½œ**ã€‚

äºæ˜¯æ­¤é¢˜æ»¡è¶³æ ‘çŠ¶æ•°ç»„åŒºé—´ä¿®æ”¹ã€å•ç‚¹æŸ¥è¯¢çš„ç‰¹å¾ï¼Œå¯ä»¥ç”¨æ ‘çŠ¶æ•°ç»„è§£å†³ã€‚

- å¯¹äºåŒºé—´ç¿»è½¬æ“ä½œï¼Œæˆ‘ä»¬ç›´æ¥å°† $[L,R]$ å†…çš„æ•°åŠ ä¸€ï¼Œå¯¹åº”å·®åˆ†æ•°ç»„å³ä¸ºï¼š$b_{L} \gets b_{L} + 1$ï¼Œ$b_{R + 1} \gets b_{R + 1} - 1$ï¼›
- å¯¹äºæŸ¥è¯¢æ“ä½œï¼Œæ­£å¸¸ `query` è·å–å€¼åè¾“å‡ºæ—¶ $\ \bmod 2$ å³å¯ã€‚
<!-- endtab -->
<!-- tab ä»£ç  -->
```cpp
#include <bits/stdc++.h>
using namespace std;
#define int long long
#define max_n 1001000
void read(int &p)
{
    p = 0;
    int k = 1;
    char c = getchar();
    while (c < '0' || c > '9')
    {
        if (c == '-')
        {
            k = -1;
        }
        c = getchar();
    }
    while (c >= '0' && c <= '9')
    {
        p = p * 10 + c - '0';
        c = getchar();
    }
    p *= k;
    return;
}
void write_(int x)
{
    if (x < 0)
    {
        putchar('-');
        x = -x;
    }
    if (x > 9)
    {
        write_(x / 10);
    }
    putchar(x % 10 + '0');
}
void writesp(int x)
{
    write_(x);
    putchar(' ');
}
void writeln(int x)
{
    write_(x);
    putchar('\n');
}
int nums[max_n], tree[max_n];
int n, Q;
int lowbit(int x)
{
    return (-x) & x;
}
void update(int x, int val)
{
    for (; x <= n; x += lowbit(x))
    {
        tree[x] += val;
    }
}
int query(int x)
{
    int res = 0;
    for (; x > 0; x -= lowbit(x))
    {
        res += tree[x];
    }
    return res;
}
signed main()
{
    read(n), read(Q);
    for (int i = 1, op, a, b; i <= Q; i++)
    {
        read(op);
        if (op == 2)
        {
            read(a);
            writeln(query(a) % 2);
        }
        else
        {
            read(a), read(b);
            update(a, 1);
            update(b + 1, -1);
        }
    }
    return 0;
}
```
<!-- endtab -->
{% endtabs %}
{%endnote%}
{%endnote%}

ç”±äºæ™®é€šçš„æ ‘çŠ¶æ•°ç»„å•ç‹¬ä½¿ç”¨è¾ƒå°‘ï¼Œä¸€èˆ¬ç”¨äºå›¾è®ºæˆ–å…¶ä»–é¢˜ç›®å½“ä¸­ä½œä¸ºè¾…åŠ©å·¥å…·ï¼Œè¿™é‡Œåªä¸¾ä¸¤é“ä¾‹é¢˜ï¼Œåœ¨å­¦ä¹ å›¾è®ºåï¼Œä¼šæœ‰æ›´å¤šä¾‹é¢˜ã€‚

æ ‘çŠ¶æ•°ç»„é™¤äº†å¯ä»¥è¿›è¡Œå•ç‚¹ä¿®æ”¹åŒºé—´æŸ¥è¯¢å¤–ï¼Œè¿˜å¯ä»¥è¿›è¡ŒåŒºé—´ä¿®æ”¹å•ç‚¹æŸ¥è¯¢ï¼Œè¿™é‡Œä½¿ç”¨äº†å·®åˆ†çš„æ€æƒ³ï¼Œé€šè¿‡æ ‘çŠ¶æ•°ç»„ç»´æŠ¤å·®åˆ†æ•°ç»„æ¥å®ç°ã€‚


### æ ‘çŠ¶æ•°ç»„è¿›é˜¶ï¼šåŒºé—´ä¿®æ”¹ã€åŒºé—´æŸ¥è¯¢

#### è®²è§£æ¨å¯¼

**æ³¨æ„ï¼šæ­¤å¤„å»ºè®®ç†è§£è€Œéå•çº¯èƒŒè¯µï¼Œæ›´æœ‰åˆ©äºåé¢çŸ¥è¯†å­¦ä¹ ã€‚**

{%note%}
ç»™å®šæ•°ç»„ $a$ï¼Œç»´æŠ¤ä¸€ä¸‹æ“ä½œï¼š
- `1 L R x`ï¼šå°† $\forall i \in [l,r],a_{i}$ å˜ä¸º $a_{i}+x$ï¼›
- `2 L R`ï¼š æŸ¥è¯¢ $\sum\limits_{i = l}^{r} a_{i}$ çš„å€¼ï¼›
{%endnote%}

é¦–å…ˆï¼Œä¸ºäº†æ»¡è¶³ä¿®æ”¹æ—¶çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ ‘çŠ¶æ•°ç»„ç»´æŠ¤çš„ä¸€å®šè¿˜æ˜¯åŸæ•°ç»„çš„å·®åˆ†æ•°ç»„ $b$ã€‚

é‚£ä¹ˆæŸ¥è¯¢çš„æ—¶å€™åº”è¯¥å¦‚ä½•åšå‘¢ï¼Ÿæˆ‘ä»¬å°è¯•æ¨å¯¼ä¸€ä¸‹ç­”æ¡ˆä¸ $b$ æ•°ç»„ä¹‹é—´çš„å…³ç³»ï¼ŒåŒºé—´å’Œå¯ä»¥è½¬åŒ–ä¸ºå‰ç¼€å’Œä¹‹å·®ï¼Œå› æ­¤ä¸‹é¢åªè®¨è®ºå‰ç¼€å’Œï¼š

$$
\begin{aligned}
\sum_{i = 1}^{R} &= \sum_{i = 1}^{R} \sum_{j = 1}^{i} b_{j} \\\\
&= \sum_{i = 1}^{R} b_{i} \times (R - i + 1) \\\\
&= \sum_{i = 1}^{R} [b_{i} \times (R + 1)] - \sum_{i = 1}^{R} b_{i} \times i \\\\
&= (R + 1) \sum_{i = 1}^{R} b_{i} - \sum_{i = 1}^{R} b_{i} \times i
\end{aligned}
$$

ä¸Šé¢çš„æ¨å¯¼è¿‡ç¨‹å¯ä»¥è‡ªå·±æ¨ä¸€æ¨ï¼ˆå¦‚æœæœ‰é—®é¢˜å¯ä»¥åœ¨ä¸‹æ–¹è¯„è®ºæˆ–åœ¨ [11 Online Judge](https://oj.cnryh.cn/user#/1)ç§ä¿¡æˆ‘ï¼‰ï¼Œå¯¹äºå…¶ä»–é¢˜ç›®çš„è§£å†³è¿˜æ˜¯æœ‰ä¸€å®šå¯å‘æ€§çš„ã€‚

è§‚å¯Ÿå‘ç°æˆ‘ä»¬éœ€è¦ç»´æŠ¤ $\sum_{i = 1}^{R} b_{i}$ å’Œ $\sum_{i = 1}^{R} b_{i} \times i$ï¼Œæ±‚å’Œå¯ä»¥ç”¨æ ‘çŠ¶æ•°ç»„æŸ¥è¯¢ï¼Œæ•…è€ƒè™‘ä¿®æ”¹æ—¶ $b_{i}$ å’Œ $b_{i} \times i$ ä¼šæœ‰ä»€ä¹ˆå˜åŒ–ï¼š

- å¯¹äº $b_{i}$ï¼Œæ›´æ”¹æ—¶ $b_{l} \gets b_{l} + x$ï¼Œ$b_{r+1} \gets b_{r + 1} - x$;
- å¯¹äº $b_{i} \times i$ï¼Œæ›´æ–°æ—¶ $b_{l} \times l \gets (b_{l} + x) \times l$ï¼Œ$b_{r+1} \times (r+1) \gets (b_{r + 1} - x) \times r + 1$ã€‚

äºæ˜¯å¼€ä¸¤é¢—çº¿æ®µæ ‘åˆ†åˆ«ç»´æŠ¤å³å¯ã€‚

#### æ¨¡æ¿é¢˜


{%note primary [SY52 ã€æ¨¡æ¿ã€‘åŒºé—´æ”¹æŸ¥æ ‘çŠ¶æ•°ç»„](https://oj.cnryh.cn/problem#/SY52) %}

{% lg /images/logo.png %}
SY52 ã€æ¨¡æ¿ã€‘åŒºé—´æ”¹æŸ¥æ ‘çŠ¶æ•°ç»„ | https://oj.cnryh.cn/problem#/SY52 | 11 Online Judge
{% endlg %}

ä¾æ—§æ˜¯æ¨¡æ¿é¢˜ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

{%note success Code%}
```cpp
#include <bits/stdc++.h>
using namespace std;
#define int long long
#define max_n 1010101
void read(int &p)
{
    p = 0;
    int k = 1;
    char c = getchar();
    while (c < '0' || c > '9')
    {
        if (c == '-')
        {
            k = -1;
        }
        c = getchar();
    }
    while (c >= '0' && c <= '9')
    {
        p = p * 10 + c - '0';
        c = getchar();
    }
    p *= k;
    return;
}
void write_(int x)
{
    if (x < 0)
    {
        putchar('-');
        x = -x;
    }
    if (x > 9)
    {
        write_(x / 10);
    }
    putchar(x % 10 + '0');
}
void writesp(int x)
{
    write_(x);
    putchar(' ');
}
void writeln(int x)
{
    write_(x);
    putchar('\n');
}
int n, q;
int nums[max_n];
int lowbit(int x)
{
    return (-x) & x;
}
struct BirTree
{
    int tree[max_n];
    void add(int x, int val)
    {
        for (; x <= n; x += lowbit(x))
        {
            tree[x] += val;
        }
        return;
    }
    int query(int x)
    {
        int sum = 0;
        for (; x; x -= lowbit(x))
        {
            sum += tree[x];
        }
        return sum;
    }
    int query(int l, int r)
    {
        return query(r) - query(l - 1);
    }
} tree1, tree2;
signed main()
{
    read(n), read(q);
    for (int i = 1; i <= n; i++)
    {
        read(nums[i]);
        tree1.add(i, nums[i] - nums[i - 1]);
        tree2.add(i, i * (nums[i] - nums[i - 1]));
    }
    for (int i = 1, op, l, r, x; i <= q; i++)
    {
        read(op), read(l), read(r);
        if (op == 1)
        {
            read(x);
            tree1.add(l, x);
            tree2.add(l, x * l);
            tree1.add(r + 1, -x);
            tree2.add(r + 1, -x * (r + 1));
        }
        else
        {
            writeln((r+1)*tree1.query(r)-l*tree1.query(l-1)+tree2.query(l-1)-tree2.query(r));
        }
    }
    return 0;
}
```
{%endnote%}


{%endnote%}

## äºŒç»´æ ‘çŠ¶æ•°ç»„

å‰ç½®çŸ¥è¯†ï¼šäºŒç»´å‰ç¼€å’Œã€äºŒç»´å·®åˆ†ã€æ™®é€šæ ‘çŠ¶æ•°ç»„

äºŒä½æ ‘çŠ¶æ•°ç»„ä¸ä¸€ç»´æ ‘çŠ¶æ•°ç»„ç±»ä¼¼ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸º $O(Q \log^{2}(n))$ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(n^{2})$ï¼Œé€‚åˆç»´æŠ¤è§„æ¨¡ä¸å¤§çš„äºŒç»´ç»“æ„ã€‚

è¿™é‡Œç›´æ¥ç»™å‡ºä¾‹é¢˜å’Œä»£ç ï¼š